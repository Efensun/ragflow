; coinex_customer_chatbot 服务配置
; 放置在 /etc/supervisor/conf.d/coinex_customer_chatbot.conf

; Web服务器 - 使用uWSGI
[program:coinex_customer_chatbot_server]
command=uwsgi %(ENV_PYTHONPATH)s/deployment/uwsgi.ini
directory=%(ENV_PYTHONPATH)s
user=nobody
autostart=true
autorestart=true
startretries=5
redirect_stderr=true
stdout_logfile=/var/log/supervisor/coinex_customer_chatbot_server.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=3
priority=100

; 后台任务处理器
[program:coinex_customer_chatbot_task]
command=python3 rag/svr/task_executor.py %(process_num)d
directory=%(ENV_PYTHONPATH)s
user=nobody
process_name=%(program_name)s_%(process_num)02d
numprocs=%(ENV_WS)s
autostart=true
autorestart=true
startretries=5
redirect_stderr=true
stdout_logfile=/var/log/supervisor/coinex_customer_chatbot_task_%(process_num)02d.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=3
priority=200
environment=LD_PRELOAD="%(ENV_JEMALLOC_PATH)s"

; 进程组配置
[group:coinex_customer_chatbot]
programs=coinex_customer_chatbot_server,coinex_customer_chatbot_task
priority=999 